window.ParentIDE=null!=window.opener?window.opener:window.parent,window.Consts={iframeUrlPrefix:window.previewUrl,frameSize:55,deviceList:{iphone8:{platform:"iOS",name:"iPhone 8",width:750,height:1334,viewportWidth:375},iphone8plus:{platform:"iOS",name:"iPhone 8 Plus",width:1242,height:2208,viewportWidth:414},iphonex:{platform:"iOS",name:"iPhone X",width:1125,height:2436,viewportWidth:375},ipadpro10:{platform:"iOS",name:"iPad Pro 10.5in",width:1668,height:2224,viewportWidth:834},ipadpro12:{platform:"iOS",name:"iPad Pro 12.9in",width:2048,height:2732,viewportWidth:1024},pixel2:{platform:"Android",name:"Pixel 2",width:1080,height:1920,viewportWidth:360},pixel2xl:{platform:"Android",name:"Pixel 2 XL",width:1440,height:2880,viewportWidth:480},galaxys8:{platform:"Android",name:"Galaxy S8",width:1440,height:2960,viewportWidth:480},xperiaxz1:{platform:"Android",name:"Xperia XZ1",width:1080,height:1920,viewportWidth:360}},checkIcon:"ui-icon-check",isIde:ParentIDE.config&&ParentIDE.config.isIde||!1,isEditor:ParentIDE.config&&ParentIDE.config.isEditor||!1,projectId:window.projectId},window.i18n={textMap:{ja:{USE_DEBUGGER:'正確に表示するには、<a href="https://docs.monaca.io/ja/manual/debugger/" target="_blank">Monaca Debugger</a> を利用してください。',VERTICAL:"縦向き",HORIZONTAL:"横向き"},en:{USE_DEBUGGER:'To see the actual design, use <a href="https://docs.monaca.io/en/manual/debugger/" target="_blank">Monaca Debugger</a>.',VERTICAL:"Vertical",HORIZONTAL:"Horizontal"}},text:function(t){return i18n.textMap["ja"==LANG?"ja":"en"][t]},applyText:function(){$(".i18n-text").each(function(t,e){$element=$(e);var i=$element.data("i18n");$element.html(i18n.text(i))})}},window.Device={isVertical:!0,aspect:"iphone8",showMsgDebugger:!0,SETTING_ATTR_LIST:["isVertical","aspect","showMsgDebugger"],setDefaultAspect:function(){void 0===Consts.deviceList[this.aspect]&&(this.aspect="iphone8")},getAspect:function(){return this.aspect},setAspect:function(t){this.aspect=t,this.saveSettings(),this.onAspectChange()},onAspectChange:function(){window.subscribeData&&window.subscribeData.PubSub.publish(window.subscribeData.Constant.EVENT.PREVIEWER_VIEW_DEVICE_CHANGED,{id:this.aspect,device:window.Consts.deviceList[this.aspect],componentId:window.previewerId})},getIsVertical:function(){return this.isVertical},setIsVertical:function(t){this.isVertical=t,this.saveSettings()},getRawWidth:function(){return this.setDefaultAspect(),Consts.deviceList[this.aspect].width},getRawHeight:function(){return this.setDefaultAspect(),Consts.deviceList[this.aspect].height},getRawViewportWidth:function(){return this.setDefaultAspect(),Consts.deviceList[this.aspect].viewportWidth},getRawViewportHeight:function(){return this.setDefaultAspect(),Math.round(this.getRawHeight()*(this.getRawViewportWidth()/this.getRawWidth()))},getViewportWidth:function(){return this.isVertical?this.getRawViewportWidth():this.getRawViewportHeight()},getViewportHeight:function(){return this.isVertical?this.getRawViewportHeight():this.getRawViewportWidth()},getWidth:function(){return this.isVertical?this.getRawWidth():this.getRawHeight()},getHeight:function(){return this.isVertical?this.getRawHeight():this.getRawWidth()},reload:function(){$E.iframe.attr("src",FileCombo.getUrl())},getStorageKey:function(){return`${Consts.projectId}_${window.previewerId}_previewer`},saveSettings:function(){var t=this,e={};t.SETTING_ATTR_LIST.forEach(function(i){e[i]=t[i]}),localStorage.setItem(t.getStorageKey(),JSON.stringify(e))},getSettingParamsStr:function(){var t=localStorage.getItem(this.getStorageKey()),e="";return null!=t&&(t=JSON.parse(t),e="?"+this.getOrientationParamStr(t.isVertical)+this.getModelParamsStr(t.aspect)),e},getOrientationParamStr:function(t){return 1==t?"orientation=portrait":"orientation=landscape"},getModelParamsStr:function(t){var e="";for(var i in Consts.deviceList[t])e+="&"+i+"="+encodeURIComponent(Consts.deviceList[t][i]);return e},restoreSettings:function(){var t=this,e=localStorage.getItem(t.getStorageKey());null!=e&&(e=JSON.parse(e),t.SETTING_ATTR_LIST.forEach(function(i){void 0!==e[i]&&(t[i]=e[i])})),t.showMsgDebugger?$E.extraInfo.show():$E.extraInfo.hide(),this.onAspectChange()}},window.Layout={onResize:function(){var t=$E.window.innerWidth(),e=$E.window.innerHeight()-$E.nav.innerHeight()-4,i=Math.max(150,t),n=Math.max(150,e),o=Device.getViewportWidth(),a=Device.getViewportHeight(),r=Math.min(i/o,n/a);i=Math.round(o*r),n=Math.round(a*r),$E.iframe.width(o),$E.iframe.height(a),$E.iframe.css("transform","scale("+r+")"),$E.previewBox.width(i),$E.previewBox.height(n),window.setTimeout(function(){$E.extraInfo.width($E.window.innerWidth()-16)},100)}},window.FileCombo={items:{},updateOptions:function(){Device.reload()},getUrl:function(){return Consts.iframeUrlPrefix+"/www/index.html"+Device.getSettingParamsStr()}},window.Menu={init:function(){this._initDeviceDropdown(),this._initButtons()},_initDeviceDropdown:function(){const t=$("#device-dropdown"),e=Object.keys(window.Consts.deviceList);let i={};e.forEach(t=>{window.Consts.deviceList[t]}),e.forEach(t=>{const e=window.Consts.deviceList[t],n=`${e.name} (${e.width}x${e.height})`,o=`<option value="${t}" ${window.Device.getAspect()===t?"selected":""}>${n}</option>`;i[e.platform]||(i[e.platform]=[]),i[e.platform].push(o)}),Object.keys(i).forEach(e=>{const n=i[e];t.append(`<optgroup label="${e}">${n.join("")}</optgroup>`)}),t.on("change",t=>{window.Device.setAspect(t.currentTarget.value),window.Device.reload(),window.Layout.onResize()})},_initButtons:function(){$portraitButton=$("#orientation-button-portait"),$landscapeButton=$("#orientation-button-landscape"),window.Device.isVertical?$portraitButton.addClass("disabled"):$landscapeButton.addClass("disabled"),$portraitButton.on("click",()=>(window.Device.setIsVertical(!0),window.Device.reload(),window.Layout.onResize(),$portraitButton.addClass("disabled"),$landscapeButton.removeClass("disabled"),!1)),$landscapeButton.on("click",()=>(window.Device.setIsVertical(!1),window.Device.reload(),window.Layout.onResize(),$landscapeButton.addClass("disabled"),$portraitButton.removeClass("disabled"),!1)),$("#reload-button").on("click",()=>(window.Device.reload(),!1)),$("#attach-button").on("click",()=>(window.Consts.isEditor?window.close():window.parentPreviewer.onAttachBtn(),!1)),$("#detach-button").on("click",()=>(window.parentPreviewer.onDetachBtn(),!1))}},$(function(){window.Consts.isEditor?(window.componentId=location.search.match(/id=(\d*)/)[1],window.previewerId="mn-gl-"+componentId,window.parentPreviewer=ParentIDE.angular.element(ParentIDE.document.querySelector(`#${previewerId} .previewer-view`)).isolateScope(),window.subscribeData=ParentIDE.angular.element(ParentIDE.document.querySelector(".ide-wrapper")).scope().fetchForSubscribe()):window.Consts.isIde&&(window.parentPreviewer=ParentIDE.Ext.getCmp("component:previewpanel")),window.onbeforeunload=function(t){window.Consts.isEditor?window.subscribeData.PubSub.publish(window.subscribeData.Constant.EVENT.TOGGLE_PREVIEWER_VIEW,{open:!0,componentState:{id:componentId}}):window.parentPreviewer.onAttachBtn()},window.$E={window:$(window),nav:$("nav"),previewWrap:$("#PreviewWrap"),previewBox:$("#PreviewBox"),extraInfo:$("#ExtraInfo"),iframe:$("#PreviewBox iframe")},i18n.applyText(),Device.restoreSettings(),Layout.onResize(),Menu.init(),FileCombo.updateOptions(),$E.window.resize(function(){Layout.onResize()}),$E.extraInfo.find(".close-btn").click(function(){return $E.extraInfo.fadeOut(200),Device.showMsgDebugger=!1,Device.saveSettings(),!1}),window.Consts.isIde||window.Consts.isEditor||($("#attach-button").hide(),$("#detach-button").hide());var t=window;window.Consts.isIde?ParentIDE.MessageHub.subscribe(ParentIDE.Message.UpdateEditorState,function(e){try{switch(e.updatePreviewPanel()){case"show":FileCombo.getTag().prop("disabled");break;case"update":t.setTimeout(function(){t.Device.reload()},600)}}catch(t){}}):window.Consts.isEditor&&window.subscribeData.PubSub.subscribe(window.subscribeData.Constant.EVENT.REFRESH_PREVIEWER,function(){t.setTimeout(function(){t.Device.reload()},600)})});